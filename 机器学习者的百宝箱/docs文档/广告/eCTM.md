# 看懂eCPM：广告排序的核心逻辑
eCPM（Expected Cost Per Mille，每千次展示预期收益），简单说就是**广告平台预估一条广告展示1000次能赚多少钱**。它是广告平台决定“先给谁的广告曝光”的核心依据——毕竟平台的核心目标之一是通过合理排序实现收益最大化。


## 一、eCPM怎么算？核心公式看收费方式
eCPM的计算不是固定的，核心取决于广告主和平台约定的“付费方式”。最基础的通用公式是：`eCPM = (广告总收入 ÷ 总展示次数) × 1000`，但实际中更常用的是按以下两种付费模式拆分计算：

### 1. CPC模式（按点击付费，最常见）
适用于抖音、微信朋友圈等多数信息流广告，广告主只在用户点击广告时才付费。  
**公式**：`eCPM = 预估点击率（pCTR）× 广告出价（Bid）`  
逻辑：平台先算“这条广告大概有多少人会点”，再乘以“广告主愿意为每次点击花多少钱”，得出千次展示的预期收益。  

*例子*：某教育机构出价2元/次点击，平台预测其广告点击率为0.5%（即1000人看有5人点），则eCPM=0.5%×2=0.01元/次展示 → 千次展示预期赚10元。


### 2. CPA模式（按转化付费，效果导向）
适用于电商、APP下载等“看最终效果”的广告，广告主只在用户完成“购买、注册、下载”等指定动作（即“转化”）时付费。  
**公式**：`eCPM = 预估转化率（pCVR）× 广告出价（CPA_bid）`  
逻辑：平台算“这条广告每展示1000次大概能带来多少次转化”，乘以“每次转化的出价”，得出预期收益。  

*例子*：某电商商家出价50元/次购买，平台预测其广告转化率为0.1%（即1000人看有1人买），则eCPM=0.1%×50=0.05元/次展示 → 千次展示预期赚50元。


## 二、eCPM排序三步走：平台怎么决定先展示谁？
广告排序的核心就是“比eCPM高低”，具体分3步走：

### 1. 第一步：预测点击率/转化率（靠AI算概率）
平台会用**机器学习模型**（最常用的是“逻辑回归”模型）预测广告的点击/转化概率，本质是“从历史数据里找规律”。  
- 数据来源：收集过往广告的“展示记录”——用户点了/买了，就算“好数据”；没点/没买，就算“坏数据”。  
- 参考维度：广告素材（图片/视频是否吸睛）、用户标签（年龄/兴趣是否匹配）、广告主行业（比如美妆vs家电的点击率差异）等。  
- 简单原理（用代码举例）：通过历史数据训练模型，让模型学会“什么样的广告+什么样的用户=高点击/转化”，再用模型预测新广告的概率。
  ```python
  from sklearn.linear_model import LogisticRegression
  from sklearn.model_selection import train_test_split

  # features：广告特征（如素材类型、用户年龄）+ 用户特征
  # labels：0=未点击/转化，1=已点击/转化（历史数据）
  # 拆分训练集和测试集
  X_train, X_test, y_train, y_test = train_test_split(features, labels, test_size=0.2)

  # 训练模型
  model = LogisticRegression()
  model.fit(X_train, y_train)
  # 用模型预测新广告的点击率（pCTR）
  pCTR = model.predict_proba(X_test)[:, 1]
  ```


### 2. 第二步：算eCPM（套公式出结果）
根据广告的付费模式（CPC/CPA），代入第一步预测的pCTR/pCVR和广告主的出价，算出每条广告的eCPM值。


### 3. 第三步：按eCPM排序（谁高谁先上）
把所有待展示的广告按eCPM从高到低排，eCPM越高的广告，越先获得曝光机会——因为它能给平台带来更高的预期收益。


## 三、eCPM排序的优化：不只是“比高低”
实际业务中，平台不会只看eCPM，还会兼顾“用户体验”“广告主效果”等，所以会对排序公式做优化，常见有3种方式：

### 1. 价格挤压因子：平衡“点击率”和“出价”
当平台想调整“点击率”和“出价”的权重时，会用这个优化公式：`eCPM = pCTR^k × Bid`（k是价格挤压因子）。  
- 若k＜1：降低点击率的影响，让“出价高”的广告更容易上位（比如有的平台想优先留住高预算广告主时会这么调）；  
- 若k＞1：提高点击率的影响，让“用户更愿意点”的广告优先（避免用户看到反感的低点击广告，保护用户体验）。


### 2. 多目标优化：兼顾多方需求
除了平台收益，还要考虑广告主的ROI（投资回报率）、用户是否反感等，公式会加入多个维度的权重，比如：  
`排序得分 = a1×出价×点击率 + a2×点击率×转化率 + a3×商品价格`  
- 说明：a1、a2、a3是“权重系数”（平台根据业务重心调整，比如电商平台可能提高a3的权重，优先推高客单价商品）；  
- 目的：避免只看eCPM导致“高出价但没人点”“点击高但不转化”的广告霸屏，兼顾平台、广告主、用户三方利益。


### 3. OCPC模式优化：保证广告主效果的前提下赚更多
OCPC（优化点击付费）是平台帮广告主“控成本”的模式——广告主设定一个目标转化成本（比如“每注册成本不超过30元”），平台在满足这个约束的基础上，最大化eCPM。  
- 例子公式：`目标得分 = 预估点击率×预估转化率×商品价格 + α×预估点击率×出价`  
- 说明：α是平衡“商品交易额（GMV）”和“eCPM”的系数，既保证广告主能卖出货，又让平台获得合理收益。


## 四、最后一步：重排序——避免广告“千篇一律”
初步排序后，平台还会做“重排序”，核心目的是**增加广告多样性**，避免用户连续看到同类型广告（比如一直刷到奶粉广告）而反感。  
- 逻辑：不颠覆原有的eCPM排序结果，但在小范围内调整顺序（比如把第3位的美妆广告和第5位的服饰广告互换）；  
- 效果：既不影响平台整体收益，又能提升用户体验，让广告更“耐看”。


总之，eCPM是广告排序的“基础标尺”，但实际操作中会结合业务目标（如用户留存、广告主复购）不断调整优化，最终实现“平台赚钱、广告主有效、用户不反感”的平衡。