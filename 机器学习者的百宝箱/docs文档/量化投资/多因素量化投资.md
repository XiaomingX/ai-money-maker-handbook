## 多因子量化投资策略：用大白话和代码教你玩A股

多因子量化投资，简单说就是**结合多个选股指标（也就是"因子"）**，用电脑程序帮你选股票、定买入比例，目标是稳定赚钱。这就像中医看病，不只看一个症状，而是综合体质、饮食、生活习惯等多方面判断。

**核心逻辑**：不同因子反映股票的不同特点，有的体现公司赚钱能力，有的显示股票风险高低。把这些因子合起来看，能更全面评估一只股票值不值得买。

### 1. 数据准备：巧妇难为无米之炊

玩多因子策略，首先得有数据。需要收集股票的历史价格、财务报表（比如利润、收入）等数据。

*   **股票价格数据**：比如2010年到2023年，贵州茅台（600519.SH）、宁德时代（300750.SZ）、招商银行（600036.SH）的股价。
*   **财务数据**：市盈率（PE）、市净率（PB）、净利润增长率等。

**代码示例（Python + tushare）**：
```python
import pandas as pd
import tushare as ts

# 设置tushare接口（需要注册获取token）
ts.set_token('你的token')
pro = ts.pro_api()

# 定义股票池（A股代码）
symbols = ['600519.SH', '300750.SZ', '600036.SH']  # 茅台、宁德时代、招行

# 获取日线数据（包含收盘价）
def get_price_data(stock_code, start_date, end_date):
    df = pro.daily(ts_code=stock_code, start_date=start_date, end_date=end_date)
    df = df[['trade_date', 'close']].sort_values('trade_date')
    return df.rename(columns={'close': stock_code})

# 获取市盈率数据
def get_pe_data(stock_code, start_date, end_date):
    df = pro.daily_basic(ts_code=stock_code, start_date=start_date, end_date=end_date, 
                        fields='trade_date, pe_ttm')
    df = df.sort_values('trade_date')
    return df.rename(columns={'pe_ttm': stock_code})

# 时间范围（格式：YYYYMMDD）
start_date = '20100101'
end_date = '20231231'

# 收集数据
price_data = []
pe_data = []

for code in symbols:
    price_df = get_price_data(code, start_date, end_date)
    price_data.append(price_df.set_index('trade_date'))
    
    pe_df = get_pe_data(code, start_date, end_date)
    pe_data.append(pe_df.set_index('trade_date'))

# 合并数据
prices = pd.concat(price_data, axis=1)
pe_ratios = pd.concat(pe_data, axis=1)

# 合并因子数据
factors = pd.concat([pe_ratios], keys=['市盈率'])
print("因子数据合并完成！")
```

**代码说明**：
*   `tushare`：国内常用的股票数据接口，需要注册获取免费token
*   示例获取了A股常见的白马股数据，更符合国内市场
*   实际使用时可以增加市净率、营收增长率等更多因子

### 2. 因子选择：选对指标是关键

选对因子很重要。好的因子要满足：
*   **能预测**：能看出股票未来表现
*   **不重复**：不同因子反映不同信息
*   **够稳定**：在一段时间内都有效

适合A股的常见因子：
*   **估值类**：市盈率（PE）、市净率（PB）、股息率。比如低市盈率可能表示股票被低估。
*   **成长类**：净利润增长率、营收增长率。高增长率可能意味着公司在快速发展。
*   **质量类**：资产负债率、毛利率。低资产负债率说明公司财务稳健。
*   **市场类**：换手率、成交量。换手率突然放大可能表示有资金关注。
*   **特色因子**：北向  - 北向交所的融资余额变化（反映市场做多情绪）
  - 北向股通持股比例（北向资金持仓变化）

**举例**：
*   **因子1：近三年净利润增长率**
  - A公司年均增长25%，B公司年均增长5%
  - 说明A公司成长潜力可能更大
*   **因子2：北向资金持仓比例**
  - A公司北向持仓从1%升到5%，B公司从3%降到1%
  - 说明外资更看好A公司

### 3. 因子评分：给股票打分

有了数据后要给每个因子评分。因为不同因子数值范围不一样，不能直接相加。常用方法：

*   **标准化**：把数据转换成均值为0，标准差为1的分布
*   **排名法**：按因子数值排序，给出排名分
*   **分档法**：把所有股票分成几档，比如最优秀的给100分，最差的给0分

**代码示例**：
```python
# 因子标准化处理
def standardize_factor(factor_df):
    # 对每一列（每个股票）进行标准化
    return (factor_df - factor_df.mean()) / factor_df.std()

# 因子打分（排名法）
def score_factor(factor_df, ascending=True):
    # ascending=True表示因子越小越好（如市盈率）
    # ascending=False表示因子越大越好（如增长率）
    return factor_df.rank(ascending=ascending, pct=True)

# 处理市盈率（数值越小越好）
pe_standardized = standardize_factor(pe_ratios)
pe_score = score_factor(pe_standardized, ascending=True)

# 假设我们还有增长率数据（数值越大越好）
# growth_standardized = standardize_factor(growth_ratios)
# growth_score = score_factor(growth_standardized, ascending=False)
```

### 4. 权重分配：决定各买多少

计算每只股票的综合得分，再按得分分配资金。常用方法：

*   **等权重**：每个因子占同样比重
*   **自主加权**：觉得哪个因子重要就给它更高权重
*   **智能优化**：用算法找到最优权重组合

**代码示例**：
```python
# 假设我们有市盈率和增长率两个因子，各占50%权重
# 注意：这里需要先准备好growth_score数据
# stock_scores = (pe_score * 0.5) + (growth_score * 0.5)

# 简化示例：仅用市盈率得分
stock_scores = pe_score

# 计算每只股票的权重（得分越高，权重越大）
weights = stock_scores / stock_scores.sum(axis=1).values.reshape(-1, 1)

# 显示最新的权重分配
print("最新权重分配：")
print(weights.iloc[-1])
```

### 5. 常见策略组合

*   **等权重组合**：把资金平均分给选出来的股票
*   **核心卫星策略**：70%资金投大盘蓝筹（核心），30%投成长股（卫星）
*   **股债平衡**：60%股票（用多因子选），40%国债或货币基金

### 6. 风险管理：控制风险才能长久赚钱

多因子策略不是稳赚不赔，必须做好风险管理：

*   **分散行业**：不要把超过30%的资金投在一个行业
*   **控制仓位**：单只股票仓位不超过10%
*   **设置止损**：单只股票跌10%就止损，组合整体跌15%就清仓
*   **定期调仓**：每月或每季度根据最新数据调整一次

**关键指标**：
*   **夏普比率**：衡量风险调整后收益，数值越高越好，优秀策略应大于1.5
*   **最大回撤**：历史上从最高点到最低点的跌幅，最好控制在20%以内

**实际应用建议**：
1. 先用过去5年数据回测策略效果
2. 实盘时先投入小资金试错
3. 关注政策变化（A股受政策影响较大）
4. 可以结合行业轮动，在不同季度侧重不同行业因子

**总结**：
多因子量化投资需要一点编程和金融知识，但掌握后能帮你更科学地选股。关键是不断回测优化，找到适合自己的策略。
